// Header Ïª¥Ìè¨ÎÑåÌä∏ - Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥, Ìé∏ÏßëÎ™®Îìú, ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌÜµÌï©
class Header {
    constructor() {
        this.isEditMode = false;
        this.currentUser = null;
        this.authService = null;
        this.initializeHeader();
    }

    // Header Ï¥àÍ∏∞Ìôî
    initializeHeader() {
        this.createHeaderHTML();
        
        // DOM ÏöîÏÜåÍ∞Ä ÏÉùÏÑ±Îêú ÌõÑ Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî© - Îçî Í∏¥ ÏßÄÏó∞ÏãúÍ∞Ñ
        setTimeout(() => {
            this.bindEvents();
            this.debugDOMElements();
            this.forceDropdownBinding(); // Í∞ïÏ†ú Î∞îÏù∏Îî© Ï∂îÍ∞Ä
        }, 200);
        
        console.log('‚úÖ Header Ïª¥Ìè¨ÎÑåÌä∏ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
    }

    // Header HTML ÏÉùÏÑ±
    createHeaderHTML() {
        const headerContainer = document.getElementById('headerContainer');
        if (!headerContainer) {
            console.error('headerContainerÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            return;
        }

        headerContainer.innerHTML = `
            <header class="modern-header">
                <div class="header-content">
                    <!-- Î°úÍ≥† Î∞è Ï†úÎ™© -->
                    <div class="header-left">
                        <div class="logo-section">
                            <h1 class="header-title">
                                <span class="title-icon">ü§ñ</span>
                                Í∏∞ÌöçÏûêÏùò AI Ï∞ΩÏóÖ
                            </h1>
                            <span class="header-subtitle">ÌîÑÎ†àÏ††ÌÖåÏù¥ÏÖò</span>
                        </div>
                    </div>

                    <!-- Ï§ëÏïô Ïª®Ìä∏Î°§Îì§ -->
                    <div class="header-center">
                        <!-- Ïç∏ÎÑ§Ïùº ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                        <div class="slide-thumbnail" id="slideThumbnail" title="ÌòÑÏû¨ Ïä¨ÎùºÏù¥Îìú ÎØ∏Î¶¨Î≥¥Í∏∞">
                            <div class="thumbnail-content" id="thumbnailContent">
                                <div class="thumbnail-placeholder">üìÑ</div>
                            </div>
                        </div>
                        
                        <!-- ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ -->
                        <div class="page-info" title="ÌÅ¥Î¶≠ÌïòÏó¨ ÌéòÏù¥ÏßÄ Ïù¥Îèô">
                            <button class="page-nav-btn" id="prevPageBtn" title="Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ">‚Äπ</button>
                            <span class="current-page" id="currentPageDisplay">1</span>
                            <span class="page-separator">/</span>
                            <span class="total-pages" id="totalPagesDisplay">80</span>
                            <button class="page-nav-btn" id="nextPageBtn" title="Îã§Ïùå ÌéòÏù¥ÏßÄ">‚Ä∫</button>
                            <div class="chapter-info" id="chapterInfoDisplay">Chapter 1</div>
                        </div>
                        
                        <!-- ÌéòÏù¥ÏßÄ ÏûÖÎ†• -->
                        <div class="page-input-container" id="pageInputContainer" style="display: none;">
                            <input type="number" id="pageInput" min="1" max="80" placeholder="ÌéòÏù¥ÏßÄ Î≤àÌò∏">
                            <button id="goToPageBtn">Ïù¥Îèô</button>
                            <button id="cancelPageBtn">Ï∑®ÏÜå</button>
                        </div>
                    </div>

                    <!-- Ïö∞Ï∏° Ïª®Ìä∏Î°§Îì§ -->
                    <div class="header-right">

                        <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ / Î°úÍ∑∏Ïù∏ -->
                        <div class="auth-section" id="authSection">
                            <!-- Î°úÍ∑∏Ïù∏ Ï†Ñ -->
                            <div class="auth-login" id="authLogin">
                                <button class="auth-btn google-login" id="googleLoginBtn" title="Google Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏">
                                    <svg class="google-icon" viewBox="0 0 24 24" width="12" height="12">
                                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                    </svg>
                                    <span class="auth-text">Google</span>
                                </button>
                                <button class="auth-btn guest-login" id="guestLoginBtn" title="Í≤åÏä§Ìä∏Î°ú ÏûÖÏû•">
                                    <span class="guest-icon">üë§</span>
                                    <span class="auth-text">Í≤åÏä§Ìä∏</span>
                                </button>
                            </div>

                            <!-- Î°úÍ∑∏Ïù∏ ÌõÑ -->
                            <div class="auth-profile" id="authProfile" style="display: none;">
                                <div class="user-dropdown">
                                    <button class="user-dropdown-trigger" id="userDropdownTrigger">
                                        <img class="user-avatar" id="userAvatar" src="" alt="ÌîÑÎ°úÌïÑ">
                                        <span class="user-name-display" id="userName">ÏÇ¨Ïö©Ïûê</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="user-dropdown-menu" id="userDropdownMenu" style="display: none;">
                                        <div class="dropdown-header">
                                            <img class="dropdown-avatar" id="dropdownAvatar" src="" alt="ÌîÑÎ°úÌïÑ">
                                            <div class="dropdown-user-info">
                                                <span class="dropdown-user-name" id="dropdownUserName">ÏÇ¨Ïö©Ïûê</span>
                                                <span class="dropdown-user-email" id="dropdownUserEmail">user@example.com</span>
                                            </div>
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        <div class="dropdown-items">
                                            <button class="dropdown-item" id="editModeToggle">
                                                <span class="dropdown-icon">üìù</span>
                                                <span class="dropdown-text">Ìé∏Ïßë Î™®Îìú</span>
                                                <span class="dropdown-status" id="editModeStatus">OFF</span>
                                            </button>
                                            <button class="dropdown-item" id="fullscreenToggle">
                                                <span class="dropdown-icon">‚õ∂</span>
                                                <span class="dropdown-text">Ï†ÑÏ≤¥ÌôîÎ©¥</span>
                                            </button>
                                            <button class="dropdown-item" id="helpToggle">
                                                <span class="dropdown-icon">‚ùì</span>
                                                <span class="dropdown-text">ÎèÑÏõÄÎßê</span>
                                            </button>
                                        </div>
                                        <div class="dropdown-divider"></div>
                                        <button class="dropdown-item logout-item" id="logoutBtn">
                                            <span class="dropdown-icon">üö™</span>
                                            <span class="dropdown-text">Î°úÍ∑∏ÏïÑÏõÉ</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î -->
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 1.25%;"></div>
                    </div>
                </div>
            </header>
        `;
    }

    // Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî©
    bindEvents() {
        // Ìé∏Ïßë Î™®Îìú Î≤ÑÌäº
        const editModeBtn = document.getElementById('editModeBtn');
        if (editModeBtn) {
            editModeBtn.addEventListener('click', () => this.toggleEditMode());
        }

        // ÌéòÏù¥ÏßÄ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäºÎì§
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        
        if (prevPageBtn) {
            prevPageBtn.addEventListener('click', () => {
                if (typeof goToPrevPage === 'function') {
                    goToPrevPage();
                }
            });
        }
        
        if (nextPageBtn) {
            nextPageBtn.addEventListener('click', () => {
                if (typeof goToNextPage === 'function') {
                    goToNextPage();
                }
            });
        }

        // ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ ÌÅ¥Î¶≠ÏúºÎ°ú ÌéòÏù¥ÏßÄ ÏûÖÎ†• Î™®Îìú
        const pageInfo = document.querySelector('.page-info');
        if (pageInfo) {
            pageInfo.addEventListener('click', (e) => {
                if (!e.target.classList.contains('page-nav-btn')) {
                    this.showPageInput();
                }
            });
        }

        // ÌéòÏù¥ÏßÄ ÏûÖÎ†• Í∏∞Îä•
        const goToPageBtn = document.getElementById('goToPageBtn');
        const cancelPageBtn = document.getElementById('cancelPageBtn');
        const pageInput = document.getElementById('pageInput');

        if (goToPageBtn) {
            goToPageBtn.addEventListener('click', () => {
                this.goToInputPage();
            });
        }

        if (cancelPageBtn) {
            cancelPageBtn.addEventListener('click', () => {
                this.hidePageInput();
            });
        }

        if (pageInput) {
            pageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.goToInputPage();
                } else if (e.key === 'Escape') {
                    this.hidePageInput();
                }
            });
        }

        // Ïù∏Ï¶ù Î≤ÑÌäºÎì§
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const guestLoginBtn = document.getElementById('guestLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');

        if (googleLoginBtn) {
            googleLoginBtn.addEventListener('click', () => this.handleGoogleLogin());
        }
        
        if (guestLoginBtn) {
            guestLoginBtn.addEventListener('click', () => this.handleGuestLogin());
        }
        
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => this.handleLogout());
        }

        // ÏÇ¨Ïö©Ïûê ÎìúÎ°≠Îã§Ïö¥ Ïù¥Î≤§Ìä∏ - Í∞ïÌôîÎêú Î∞îÏù∏Îî©
        const userDropdownTrigger = document.getElementById('userDropdownTrigger');
        console.log('üéØ ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ ÏöîÏÜå:', userDropdownTrigger);
        
        if (userDropdownTrigger) {
            console.log('‚úÖ ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ Î∞úÍ≤¨ - Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî©');
            
            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            userDropdownTrigger.addEventListener('click', (e) => {
                console.log('üñ±Ô∏è ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ ÌÅ¥Î¶≠Îê®!');
                e.preventDefault();
                e.stopPropagation();
                this.toggleDropdown();
            });
            
            // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ (Î™®Î∞îÏùº ÏßÄÏõê)
            userDropdownTrigger.addEventListener('touchend', (e) => {
                console.log('üëÜ ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ ÌÑ∞ÏπòÎê®!');
                e.preventDefault();
                e.stopPropagation();
                this.toggleDropdown();
            });
            
            // Ìè¨Ïª§Ïä§ Ïù¥Î≤§Ìä∏ (ÌÇ§Î≥¥Îìú Ï†ëÍ∑ºÏÑ±)
            userDropdownTrigger.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    console.log('‚å®Ô∏è ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ ÌÇ§Î≥¥Îìú ÌôúÏÑ±Ìôî!');
                    e.preventDefault();
                    this.toggleDropdown();
                }
            });
        } else {
            console.error('‚ùå ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
        }

        // ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ Ìï≠Î™©Îì§
        const editModeToggle = document.getElementById('editModeToggle');
        const fullscreenToggle = document.getElementById('fullscreenToggle');
        const helpToggle = document.getElementById('helpToggle');

        if (editModeToggle) {
            editModeToggle.addEventListener('click', () => {
                this.toggleEditMode();
                this.closeDropdown();
            });
        }

        if (fullscreenToggle) {
            fullscreenToggle.addEventListener('click', () => {
                this.toggleFullscreen();
                this.closeDropdown();
            });
        }

        if (helpToggle) {
            helpToggle.addEventListener('click', () => {
                this.toggleHelp();
                this.closeDropdown();
            });
        }

        // ÎìúÎ°≠Îã§Ïö¥ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        document.addEventListener('click', (e) => {
            const dropdownMenu = document.getElementById('userDropdownMenu');
            const userDropdown = document.querySelector('.user-dropdown');
            
            if (dropdownMenu && userDropdown && !userDropdown.contains(e.target)) {
                this.closeDropdown();
            }
        });
        
        // Ï∂îÍ∞ÄÏ†ÅÏù∏ Ïù¥Î≤§Ìä∏ ÏúÑÏûÑ Î∞©Ïãù (Î∞±ÏóÖ)
        document.addEventListener('click', (e) => {
            if (e.target.closest('#userDropdownTrigger')) {
                console.log('üéØ Ïù¥Î≤§Ìä∏ ÏúÑÏûÑÏúºÎ°ú ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ Í∞êÏßÄ!');
                e.preventDefault();
                e.stopPropagation();
                this.toggleDropdown();
            }
        });
        
        // Ìó§Îçî Ï†ÑÏ≤¥ÏóêÏÑú ÏÇ¨Ïö©Ïûê ÎìúÎ°≠Îã§Ïö¥ Í¥ÄÎ†® ÌÅ¥Î¶≠ Í∞êÏßÄ
        const headerElement = document.querySelector('.modern-header');
        if (headerElement) {
            headerElement.addEventListener('click', (e) => {
                console.log('üè† Ìó§Îçî ÌÅ¥Î¶≠ Í∞êÏßÄ:', e.target);
                
                // ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ÎÇò Í∑∏ ÌïòÏúÑ ÏöîÏÜå ÌÅ¥Î¶≠ Ïãú
                if (e.target.closest('.user-dropdown-trigger')) {
                    console.log('üéØ Ìó§ÎçîÏóêÏÑú ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ Í∞êÏßÄ!');
                    e.preventDefault();
                    e.stopPropagation();
                    this.toggleDropdown();
                }
            });
        }
    }

    // DOM ÏöîÏÜå ÎîîÎ≤ÑÍπÖ
    debugDOMElements() {
        console.log('üîç DOM ÏöîÏÜå ÎîîÎ≤ÑÍπÖ ÏãúÏûë');
        
        const elements = {
            userDropdownTrigger: document.getElementById('userDropdownTrigger'),
            userDropdownMenu: document.getElementById('userDropdownMenu'),
            userName: document.getElementById('userName'),
            userAvatar: document.getElementById('userAvatar'),
            authProfile: document.getElementById('authProfile')
        };
        
        Object.entries(elements).forEach(([name, element]) => {
            if (element) {
                console.log(`‚úÖ ${name}:`, element);
                console.log(`   - ÌÅ¥ÎûòÏä§:`, element.className);
                console.log(`   - Ïä§ÌÉÄÏùº:`, element.style.display);
                console.log(`   - Ïù¥Î≤§Ìä∏:`, element.onclick ? 'ÏûàÏùå' : 'ÏóÜÏùå');
            } else {
                console.error(`‚ùå ${name}: ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå`);
            }
        });
        
        console.log('üîç DOM ÏöîÏÜå ÎîîÎ≤ÑÍπÖ ÏôÑÎ£å');
    }

    // Í∞ïÏ†ú ÎìúÎ°≠Îã§Ïö¥ Î∞îÏù∏Îî©
    forceDropdownBinding() {
        console.log('üîß Í∞ïÏ†ú ÎìúÎ°≠Îã§Ïö¥ Î∞îÏù∏Îî© ÏãúÎèÑ');
        
        // Ï†ÑÏ≤¥ Î¨∏ÏÑúÏóêÏÑú ÎìúÎ°≠Îã§Ïö¥ ÏöîÏÜå Í≤ÄÏÉâ
        const allDropdownTriggers = document.querySelectorAll('[id*="userDropdown"], [class*="user-dropdown"], [class*="dropdown-trigger"]');
        console.log('üìç Î∞úÍ≤¨Îêú ÎìúÎ°≠Îã§Ïö¥ Í¥ÄÎ†® ÏöîÏÜåÎì§:', allDropdownTriggers);
        
        allDropdownTriggers.forEach((element, index) => {
            console.log(`üéØ ÏöîÏÜå ${index}:`, element.id, element.className);
            
            // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞ ÌõÑ ÏÉàÎ°ú Ï∂îÍ∞Ä
            element.removeEventListener('click', this.handleDropdownClick);
            element.addEventListener('click', this.handleDropdownClick.bind(this));
            
            // Ïù∏ÎùºÏù∏ onclick ÏÜçÏÑ±ÎèÑ Ï∂îÍ∞Ä
            element.setAttribute('onclick', 'window.headerInstance?.toggleDropdown()');
        });
        
        // MutationObserverÎ°ú ÎèôÏ†Å ÏöîÏÜå Í∞êÏßÄ
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                    const addedNodes = Array.from(mutation.addedNodes);
                    addedNodes.forEach(node => {
                        if (node.nodeType === 1 && node.id === 'userDropdownTrigger') {
                            console.log('üîÑ ÎìúÎ°≠Îã§Ïö¥ Ìä∏Î¶¨Í±∞ ÎèôÏ†Å Ï∂îÍ∞Ä Í∞êÏßÄ');
                            this.bindDropdownEvents(node);
                        }
                    });
                }
            });
        });
        
        observer.observe(document.body, { childList: true, subtree: true });
    }

    // ÎìúÎ°≠Îã§Ïö¥ ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
    handleDropdownClick(e) {
        console.log('üéØ Í∞ïÏ†ú Î∞îÏù∏Îî© ÎìúÎ°≠Îã§Ïö¥ ÌÅ¥Î¶≠ Í∞êÏßÄ!');
        e.preventDefault();
        e.stopPropagation();
        if (window.headerInstance) {
            window.headerInstance.toggleDropdown();
        }
    }

    // Í∞úÎ≥Ñ ÎìúÎ°≠Îã§Ïö¥ ÏöîÏÜå Î∞îÏù∏Îî©
    bindDropdownEvents(element) {
        if (!element) return;
        
        console.log('üîó Í∞úÎ≥Ñ ÎìúÎ°≠Îã§Ïö¥ Î∞îÏù∏Îî©:', element);
        
        element.addEventListener('click', (e) => {
            console.log('üñ±Ô∏è Í∞úÎ≥Ñ Î∞îÏù∏Îî© ÌÅ¥Î¶≠!');
            e.preventDefault();
            e.stopPropagation();
            this.toggleDropdown();
        });
        
        element.style.cursor = 'pointer';
        element.style.userSelect = 'none';
    }

    // ÎìúÎ°≠Îã§Ïö¥ ÌÜ†Í∏Ä
    toggleDropdown() {
        const dropdownMenu = document.getElementById('userDropdownMenu');
        const dropdownArrow = document.querySelector('.dropdown-arrow');
        
        if (dropdownMenu) {
            const isVisible = dropdownMenu.style.display !== 'none' && dropdownMenu.style.display !== '';
            
            if (isVisible) {
                dropdownMenu.style.display = 'none';
                if (dropdownArrow) dropdownArrow.textContent = '‚ñº';
                console.log('üîΩ ÎìúÎ°≠Îã§Ïö¥ Îã´Ìûò');
            } else {
                dropdownMenu.style.display = 'block';
                if (dropdownArrow) dropdownArrow.textContent = '‚ñ≤';
                console.log('üîº ÎìúÎ°≠Îã§Ïö¥ Ïó¥Î¶º');
            }
        } else {
            console.error('‚ùå ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
        }
    }

    // ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
    closeDropdown() {
        const dropdownMenu = document.getElementById('userDropdownMenu');
        const dropdownArrow = document.querySelector('.dropdown-arrow');
        
        if (dropdownMenu) {
            dropdownMenu.style.display = 'none';
        }
        
        if (dropdownArrow) {
            dropdownArrow.textContent = '‚ñº';
        }
    }

    // Ìé∏Ïßë Î™®Îìú ÌÜ†Í∏Ä
    toggleEditMode() {
        this.isEditMode = !this.isEditMode;
        const editModeStatus = document.getElementById('editModeStatus');

        if (this.isEditMode) {
            document.body.classList.add('edit-mode');
            if (editModeStatus) editModeStatus.textContent = 'ON';
            
            // Ï†ÑÏó≠ Ìé∏Ïßë Î™®Îìú Ìï®Ïàò Ìò∏Ï∂ú (Í∏∞Ï°¥ script.jsÏùò Ìï®Ïàò)
            if (window.enableEditMode) {
                window.enableEditMode();
            }
        } else {
            document.body.classList.remove('edit-mode');
            if (editModeStatus) editModeStatus.textContent = 'OFF';
            
            // Ï†ÑÏó≠ Ìé∏Ïßë Î™®Îìú Ìï®Ïàò Ìò∏Ï∂ú (Í∏∞Ï°¥ script.jsÏùò Ìï®Ïàò)
            if (window.disableEditMode) {
                window.disableEditMode();
            }
        }

        console.log('Ìé∏Ïßë Î™®Îìú:', this.isEditMode ? 'ÌôúÏÑ±Ìôî' : 'ÎπÑÌôúÏÑ±Ìôî');
    }

    // Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏
    async handleGoogleLogin() {
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        this.setButtonLoading(googleLoginBtn, true);

        // Î™ÖÏãúÏ†Å Î°úÍ∑∏Ïù∏ ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
        window.isExplicitLogin = true;

        try {
            // FirebaseÍ∞Ä ÏÇ¨Ïö© Î∂àÍ∞ÄÎä•Ìïú Í≤ΩÏö∞ Ï¶âÏãú Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôò
            if (!window.authService || !window.authService.isInitialized) {
                console.log('üîÑ Header: Firebase ÏÇ¨Ïö© Î∂àÍ∞Ä - Î°úÏª¨ Î™®ÎìúÎ°ú Ï¶âÏãú Ï†ÑÌôò');
                this.showStatus('Firebase Ïó∞Í≤∞ Î∂àÍ∞Ä - Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôòÎê©ÎãàÎã§', 'warning');
                
                setTimeout(() => {
                    if (window.enableLocalMode) {
                        window.enableLocalMode();
                        this.showStatus('Î°úÏª¨ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§', 'success');
                    }
                }, 1000);
                return;
            }
            
            // Ï†ÑÏó≠ Ïù∏Ï¶ù ÏÑúÎπÑÏä§ ÏÇ¨Ïö©
            if (window.authService && window.authService.signInWithGoogle) {
                const result = await window.authService.signInWithGoogle();
                if (result.success) {
                    this.updateAuthUI(result.user);
                    this.showStatus('Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!', 'success');
                } else {
                    // Firebase Ïò§Î•ò Ïãú Î°úÏª¨ Î™®ÎìúÎ°ú ÏûêÎèô Ï†ÑÌôò
                    console.log('üîÑ Header: Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ïã§Ìå®Î°ú Ïù∏Ìïú Î°úÏª¨ Î™®Îìú ÏûêÎèô Ï†ÑÌôò');
                    this.showStatus('Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ïã§Ìå® - Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôòÎê©ÎãàÎã§', 'warning');
                    
                    setTimeout(() => {
                        if (window.enableLocalMode) {
                            window.enableLocalMode();
                            this.showStatus('Î°úÏª¨ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§', 'success');
                        }
                    }, 1000);
                }
            } else {
                // Î°úÏª¨ Î™®ÎìúÎ°ú Ï¶âÏãú Ï†ÑÌôò
                console.log('üîÑ Header: Ïù∏Ï¶ù ÏÑúÎπÑÏä§ ÏóÜÏùå - Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôò');
                this.showStatus('Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôòÎê©ÎãàÎã§', 'warning');
                
                setTimeout(() => {
                    if (window.enableLocalMode) {
                        window.enableLocalMode();
                        this.showStatus('Î°úÏª¨ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§', 'success');
                    }
                }, 1000);
            }
        } catch (error) {
            console.error('Íµ¨Í∏Ä Î°úÍ∑∏Ïù∏ Ïò§Î•ò:', error);
            this.showStatus('Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
        } finally {
            this.setButtonLoading(googleLoginBtn, false);
        }
    }

    // Í≤åÏä§Ìä∏ Î°úÍ∑∏Ïù∏
    async handleGuestLogin() {
        const guestLoginBtn = document.getElementById('guestLoginBtn');
        this.setButtonLoading(guestLoginBtn, true);

        // Î™ÖÏãúÏ†Å Î°úÍ∑∏Ïù∏ ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
        window.isExplicitLogin = true;

        try {
            // FirebaseÍ∞Ä ÏÇ¨Ïö© Î∂àÍ∞ÄÎä•Ìïú Í≤ΩÏö∞ Ï¶âÏãú Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôò
            if (!window.authService || !window.authService.isInitialized) {
                console.log('üîÑ Header: Firebase ÏÇ¨Ïö© Î∂àÍ∞Ä - Î°úÏª¨ Í≤åÏä§Ìä∏ Î™®ÎìúÎ°ú Ï¶âÏãú Ï†ÑÌôò');
                this.showStatus('Firebase Ïó∞Í≤∞ Î∂àÍ∞Ä - Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôòÎê©ÎãàÎã§', 'warning');
                
                setTimeout(() => {
                    if (window.enableLocalMode) {
                        window.enableLocalMode();
                        this.showStatus('Î°úÏª¨ Í≤åÏä§Ìä∏ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§', 'success');
                    }
                }, 1000);
                return;
            }
            
            if (window.authService && window.authService.signInAnonymously) {
                const result = await window.authService.signInAnonymously();
                if (result.success) {
                    this.updateAuthUI(result.user);
                    this.showStatus('Í≤åÏä§Ìä∏Î°ú Î°úÍ∑∏Ïù∏ÌñàÏäµÎãàÎã§.', 'success');
                } else {
                    // Firebase Ïò§Î•ò Ïãú Î°úÏª¨ Î™®ÎìúÎ°ú ÏûêÎèô Ï†ÑÌôò
                    console.log('üîÑ Header: Í≤åÏä§Ìä∏ Î°úÍ∑∏Ïù∏ Ïã§Ìå®Î°ú Ïù∏Ìïú Î°úÏª¨ Î™®Îìú ÏûêÎèô Ï†ÑÌôò');
                    this.showStatus('Í≤åÏä§Ìä∏ Î°úÍ∑∏Ïù∏ Ïã§Ìå® - Î°úÏª¨ Î™®ÎìúÎ°ú Ï†ÑÌôòÎê©ÎãàÎã§', 'warning');
                    
                    setTimeout(() => {
                        if (window.enableLocalMode) {
                            window.enableLocalMode();
                            this.showStatus('Î°úÏª¨ Í≤åÏä§Ìä∏ Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§', 'success');
                        }
                    }, 1000);
                }
            } else {
                // Î°úÏª¨ Í≤åÏä§Ìä∏ Î™®Îìú
                const guestUser = {
                    displayName: 'Í≤åÏä§Ìä∏ ÏÇ¨Ïö©Ïûê',
                    email: null,
                    photoURL: null,
                    isAnonymous: true
                };
                this.updateAuthUI(guestUser);
                this.showStatus('Í≤åÏä§Ìä∏ Î™®ÎìúÎ°ú Ï†ëÏÜçÌñàÏäµÎãàÎã§.', 'success');
            }
        } catch (error) {
            console.error('Í≤åÏä§Ìä∏ Î°úÍ∑∏Ïù∏ Ïò§Î•ò:', error);
            this.showStatus('Í≤åÏä§Ìä∏ Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
        } finally {
            this.setButtonLoading(guestLoginBtn, false);
        }
    }

    // Î°úÍ∑∏ÏïÑÏõÉ
    async handleLogout() {
        const logoutBtn = document.getElementById('logoutBtn');
        this.setButtonLoading(logoutBtn, true);

        try {
            if (window.authService && window.authService.signOut) {
                const result = await window.authService.signOut();
                if (result.success) {
                    await this.performLogout();
                } else {
                    this.showStatus('Î°úÍ∑∏ÏïÑÏõÉ Ïã§Ìå®: ' + result.error, 'error');
                }
            } else {
                // Î°úÏª¨ Î°úÍ∑∏ÏïÑÏõÉ
                await this.performLogout();
            }
        } catch (error) {
            console.error('Î°úÍ∑∏ÏïÑÏõÉ Ïò§Î•ò:', error);
            this.showStatus('Î°úÍ∑∏ÏïÑÏõÉ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
        } finally {
            this.setButtonLoading(logoutBtn, false);
        }
    }

    // Î°úÍ∑∏ÏïÑÏõÉ ÏàòÌñâ
    async performLogout() {
        console.log('üö™ Î°úÍ∑∏ÏïÑÏõÉ ÏàòÌñâ ÏãúÏûë');
        
        try {
            // Ìé∏Ïßë Î™®Îìú ÎπÑÌôúÏÑ±Ìôî
            if (this.isEditMode) {
                console.log('üìù Ìé∏Ïßë Î™®Îìú ÎπÑÌôúÏÑ±Ìôî');
                this.toggleEditMode();
            }
            
            // ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
            console.log('üîΩ ÎìúÎ°≠Îã§Ïö¥ Î©îÎâ¥ Îã´Í∏∞');
            this.closeDropdown();
            
            // Î™ÖÏãúÏ†Å Î°úÍ∑∏Ïù∏ ÌîåÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî
            window.isExplicitLogin = false;
            console.log('üîÑ Î™ÖÏãúÏ†Å Î°úÍ∑∏Ïù∏ ÌîåÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî');
            
            // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî
            console.log('üë§ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî');
            this.updateAuthUI(null);
            
            // ÌéòÏù¥ÏßÄ ÏÉÅÌÉú Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî
            setTimeout(() => {
                // Î©îÏù∏ ÌôîÎ©¥(ÎûúÎî© ÌéòÏù¥ÏßÄ)ÏúºÎ°ú Ïù¥Îèô
                if (typeof showLanding === 'function') {
                    console.log('üè† showLanding() Ìï®Ïàò Ìò∏Ï∂ú');
                    showLanding();
                } else if (window.showLanding) {
                    console.log('üè† window.showLanding() Ìò∏Ï∂ú');
                    window.showLanding();
                } else {
                    console.warn('showLanding Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå - ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®ÏúºÎ°ú Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî');
                    window.location.reload();
                }
            }, 100);
            
            this.showStatus('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.', 'success');
            console.log('‚úÖ Î°úÍ∑∏ÏïÑÏõÉ ÏôÑÎ£å');
            
        } catch (error) {
            console.error('Î°úÍ∑∏ÏïÑÏõÉ ÏàòÌñâ Ï§ë Ïò§Î•ò:', error);
            // Ïò§Î•òÍ∞Ä Î∞úÏÉùÌï¥ÎèÑ Í∞ïÏ†úÎ°ú ÌéòÏù¥ÏßÄÎ•º Ï¥àÍ∏∞Ìôî
            console.log('‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉùÏúºÎ°ú Ïù∏Ìïú Í∞ïÏ†ú ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }
    }

    // Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä
    toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
                console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú ÏßÑÏûÖ Ïã§Ìå®:', err);
                this.showStatus('Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®ÎìúÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.', 'error');
            });
        } else {
            document.exitFullscreen().catch(err => {
                console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú Ï¢ÖÎ£å Ïã§Ìå®:', err);
            });
        }
    }

    // ÎèÑÏõÄÎßê ÌÜ†Í∏Ä
    toggleHelp() {
        const keyboardHelp = document.getElementById('keyboardHelp');
        if (keyboardHelp) {
            keyboardHelp.classList.toggle('show');
        } else if (window.toggleKeyboardHelp) {
            window.toggleKeyboardHelp();
        }
    }

    // Ïù∏Ï¶ù UI ÏóÖÎç∞Ïù¥Ìä∏
    updateAuthUI(user) {
        const authLogin = document.getElementById('authLogin');
        const authProfile = document.getElementById('authProfile');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const dropdownAvatar = document.getElementById('dropdownAvatar');
        const dropdownUserName = document.getElementById('dropdownUserName');
        const dropdownUserEmail = document.getElementById('dropdownUserEmail');

        if (user) {
            console.log('Header: Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú - UI ÏóÖÎç∞Ïù¥Ìä∏Îßå ÏàòÌñâ');
            
            // ÏûêÎèô ÌîÑÎ†àÏ††ÌÖåÏù¥ÏÖò Ïù¥Îèô Ï†úÍ±∞ - Î™ÖÏãúÏ†Å Î°úÍ∑∏Ïù∏Îßå ÌóàÏö©
            
            if (authLogin) {
                authLogin.style.display = 'none';
                console.log('Header: authLogin Ïà®ÍπÄ');
            }
            if (authProfile) {
                authProfile.style.display = 'flex';
                console.log('Header: authProfile ÌëúÏãú');
            }

            // ÏÇ¨Ïö©Ïûê Ïó≠Ìï† ÌôïÏù∏
            const role = this.getUserRole(user);
            const roleEmoji = role === 'instructor' ? 'üë®‚Äçüè´' : role === 'student' ? 'üë®‚Äçüéì' : 'üë§';
            const roleName = role === 'instructor' ? 'Í∞ïÏÇ¨' : role === 'student' ? 'ÌïôÏÉù' : 'Í≤åÏä§Ìä∏';
            const displayName = user.displayName || roleName;

            // Ìä∏Î¶¨Í±∞ Î≤ÑÌäº ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ (Í∞ÑÎã®Ìûà ÌëúÏãú)
            if (userName) {
                userName.textContent = displayName;
            }

            // ÏïÑÎ∞îÌÉÄ ÏÑ§Ï†ï
            const avatarSrc = (user.photoURL && !user.isAnonymous) ? user.photoURL : this.getDefaultAvatar();
            if (userAvatar) {
                userAvatar.src = avatarSrc;
            }

            // ÎìúÎ°≠Îã§Ïö¥ ÎÇ¥Î∂Ä ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ (ÏÉÅÏÑ∏Ìûà ÌëúÏãú)
            if (dropdownAvatar) {
                dropdownAvatar.src = avatarSrc;
            }
            if (dropdownUserName) {
                dropdownUserName.textContent = `${roleEmoji} ${displayName}`;
            }
            if (dropdownUserEmail) {
                dropdownUserEmail.textContent = user.email || (user.isAnonymous ? 'Í≤åÏä§Ìä∏ ÏÇ¨Ïö©Ïûê' : 'Ïù¥Î©îÏùº ÏóÜÏùå');
            }

            // Ìé∏Ïßë Î™®Îìú Í∂åÌïú ÏóÖÎç∞Ïù¥Ìä∏
            this.updateEditModeAccess(user);
            
            this.currentUser = user;
        } else {
            // Î°úÍ∑∏ÏïÑÏõÉ ÏÉÅÌÉú
            if (authLogin) authLogin.style.display = 'flex';
            if (authProfile) authProfile.style.display = 'none';
            
            // ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
            this.closeDropdown();
            
            this.currentUser = null;
        }
    }

    // Ìé∏Ïßë Î™®Îìú Ï†ëÍ∑º Í∂åÌïú ÏóÖÎç∞Ïù¥Ìä∏
    updateEditModeAccess(user) {
        const editModeToggle = document.getElementById('editModeToggle');
        if (!editModeToggle) return;

        const userRole = this.getUserRole(user);

        if (userRole === 'instructor') {
            // Í∞ïÏÇ¨Îäî Ìé∏Ïßë Í∞ÄÎä•
            editModeToggle.style.display = 'flex';
            editModeToggle.disabled = false;
        } else {
            // ÌïôÏÉùÍ≥º Í≤åÏä§Ìä∏Îäî Ìé∏Ïßë Î∂àÍ∞ÄÎä•  
            editModeToggle.style.display = 'none';
            editModeToggle.disabled = true;
            
            // Ìé∏Ïßë Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÎã§Î©¥ ÎπÑÌôúÏÑ±Ìôî
            if (this.isEditMode) {
                this.toggleEditMode();
            }
        }
    }

    // ÏÇ¨Ïö©Ïûê Í∂åÌïú ÌôïÏù∏
    getUserRole(user) {
        if (!user) return 'guest';

        // Í∞ïÏÇ¨ Í≥ÑÏ†ï Î™©Î°ù
        const instructorEmails = [
            'meangyun0729@gmail.com'
        ];

        if (instructorEmails.includes(user.email)) {
            return 'instructor';
        }

        return user.isAnonymous ? 'guest' : 'student';
    }

    // ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
    updatePageInfo(currentPage, totalPages, chapterInfo) {
        const currentPageEl = document.querySelector('.header-center .current-page');
        const totalPagesEl = document.querySelector('.header-center .total-pages');
        const chapterInfoEl = document.querySelector('.header-center .chapter-info');
        const progressFill = document.getElementById('progressFill');

        if (currentPageEl) currentPageEl.textContent = currentPage;
        if (totalPagesEl) totalPagesEl.textContent = totalPages;
        if (chapterInfoEl) chapterInfoEl.textContent = chapterInfo;
        
        if (progressFill) {
            const progress = (currentPage / totalPages) * 100;
            progressFill.style.width = `${progress}%`;
        }
        
        // Ïç∏ÎÑ§Ïùº ÏóÖÎç∞Ïù¥Ìä∏
        this.updateThumbnail(currentPage);
        
        // ÌéòÏù¥ÏßÄ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        this.updatePageNavButtons(currentPage, totalPages);
    }
    
    // Ïç∏ÎÑ§Ïùº ÏóÖÎç∞Ïù¥Ìä∏
    updateThumbnail(currentPage) {
        const thumbnailContent = document.getElementById('thumbnailContent');
        if (!thumbnailContent) return;
        
        // ÌòÑÏû¨ Ïä¨ÎùºÏù¥ÎìúÏùò ÎÇ¥Ïö©ÏùÑ Í∞ÄÏ†∏ÏôÄÏÑú Ïç∏ÎÑ§Ïùº ÏÉùÏÑ±
        const currentSlide = document.querySelector('.slide.active');
        if (currentSlide) {
            // Ïä¨ÎùºÏù¥ÎìúÏùò Ï†úÎ™©Ïù¥ÎÇò Ï£ºÏöî ÎÇ¥Ïö©ÏùÑ Ï∂îÏ∂ú
            const slideTitle = currentSlide.querySelector('h1, h2, h3, .slide-title')?.textContent || `Ïä¨ÎùºÏù¥Îìú ${currentPage}`;
            const slideContent = currentSlide.querySelector('p, .content, .slide-content')?.textContent || '';
            
            thumbnailContent.innerHTML = `
                <div class="thumbnail-title">${slideTitle.substring(0, 20)}${slideTitle.length > 20 ? '...' : ''}</div>
                <div class="thumbnail-text">${slideContent.substring(0, 40)}${slideContent.length > 40 ? '...' : ''}</div>
            `;
        } else {
            thumbnailContent.innerHTML = `
                <div class="thumbnail-placeholder">üìÑ</div>
                <div class="thumbnail-title">Ïä¨ÎùºÏù¥Îìú ${currentPage}</div>
            `;
        }
    }
    
    // ÌéòÏù¥ÏßÄ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    updatePageNavButtons(currentPage, totalPages) {
        const prevBtn = document.getElementById('prevPageBtn');
        const nextBtn = document.getElementById('nextPageBtn');
        
        if (prevBtn) {
            prevBtn.disabled = currentPage <= 1;
        }
        
        if (nextBtn) {
            nextBtn.disabled = currentPage >= totalPages;
        }
    }

    // Î≤ÑÌäº Î°úÎî© ÏÉÅÌÉú ÏÑ§Ï†ï
    setButtonLoading(button, isLoading) {
        if (!button) return;

        if (isLoading) {
            button.disabled = true;
            button.classList.add('loading');
        } else {
            button.disabled = false;
            button.classList.remove('loading');
        }
    }

    // ÏÉÅÌÉú Î©îÏãúÏßÄ ÌëúÏãú
    showStatus(message, type = 'info') {
        // Ï†ÑÏó≠ ÏÉÅÌÉú ÌëúÏãú Ìï®Ïàò ÏÇ¨Ïö©
        if (window.showSaveStatus) {
            window.showSaveStatus(message, type === 'success' ? 'saved' : 'error');
        } else {
            console.log(`${type.toUpperCase()}: ${message}`);
        }
    }

    // ÌéòÏù¥ÏßÄ ÏûÖÎ†• ÌëúÏãú
    showPageInput() {
        const pageInfo = document.querySelector('.page-info');
        const pageInputContainer = document.getElementById('pageInputContainer');
        const pageInput = document.getElementById('pageInput');
        
        if (pageInfo && pageInputContainer && pageInput) {
            pageInfo.style.display = 'none';
            pageInputContainer.style.display = 'flex';
            
            // ÌòÑÏû¨ ÌéòÏù¥ÏßÄÎ•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
            if (window.currentPage) {
                pageInput.value = window.currentPage;
            }
            
            // Ìè¨Ïª§Ïä§ Î∞è ÏÑ†ÌÉù
            setTimeout(() => {
                pageInput.focus();
                pageInput.select();
            }, 100);
        }
    }
    
    // ÌéòÏù¥ÏßÄ ÏûÖÎ†• Ïà®Í∏∞Í∏∞
    hidePageInput() {
        const pageInfo = document.querySelector('.page-info');
        const pageInputContainer = document.getElementById('pageInputContainer');
        
        if (pageInfo && pageInputContainer) {
            pageInfo.style.display = 'flex';
            pageInputContainer.style.display = 'none';
        }
    }
    
    // ÏûÖÎ†•Îêú ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
    goToInputPage() {
        const pageInput = document.getElementById('pageInput');
        if (!pageInput) return;
        
        const pageNumber = parseInt(pageInput.value);
        const totalPages = window.totalPages || 80;
        
        if (pageNumber >= 1 && pageNumber <= totalPages) {
            if (typeof goToPage === 'function') {
                goToPage(pageNumber);
            }
            this.hidePageInput();
        } else {
            this.showStatus(`ÌéòÏù¥ÏßÄ Î≤àÌò∏Îäî 1Î∂ÄÌÑ∞ ${totalPages} ÏÇ¨Ïù¥Ïó¨Ïïº Ìï©ÎãàÎã§.`, 'error');
            pageInput.focus();
            pageInput.select();
        }
    }

    // Í∏∞Î≥∏ ÏïÑÎ∞îÌÉÄ Î∞òÌôò
    getDefaultAvatar() {
        return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM2Yzc1N2QiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDEyQzE0LjIwOTEgMTIgMTYgMTAuMjA5MSAxNiA4QzE2IDUuNzkwODYgMTQuMjA5MSA0IDEyIDRDOS43OTA4NiA0IDggNS43OTA4NiA4IDhDOCAxMC4yMDkxIDkuNzkwODYgMTIgMTIgMTJaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTIgMTRDOC42ODYyOSAxNCA2IDE2LjY4NjMgNiAyMFYyMkgxOFYyMEMxOCAxNi42ODYzIDE1LjMxMzcgMTQgMTIgMTRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4KPC9zdmc+';
    }
}

// Header Ïù∏Ïä§ÌÑ¥Ïä§Î•º Ï†ÑÏó≠ÏúºÎ°ú ÎÖ∏Ï∂ú
window.Header = Header;
window.headerInstance = null;

// DOM Î°úÎìú ÌõÑ Header Ï¥àÍ∏∞Ìôî
document.addEventListener('DOMContentLoaded', () => {
    // Header Ïª®ÌÖåÏù¥ÎÑàÍ∞Ä ÏûàÏùÑ ÎïåÎßå Ï¥àÍ∏∞Ìôî
    const headerContainer = document.getElementById('headerContainer');
    if (headerContainer && !window.headerInstance) {
        window.headerInstance = new Header();
    }
});
